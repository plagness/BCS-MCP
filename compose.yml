services:
  bcsdb:
    image: pgvector/pgvector:pg16
    container_name: bcsdb
    labels:
      - "ns.module=bcs"
      - "ns.component=db"
      - "ns.db_owner=bcs"
    environment:
      POSTGRES_USER: bcs
      POSTGRES_PASSWORD: ${BCS_DB_PASSWORD:-bcs_secret}
      POSTGRES_DB: postgres
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
      - ./db/init:/docker-entrypoint-initdb.d:ro
    ports:
      - "127.0.0.1:${PORT_DB_BCS:-${BCS_DB_PORT:-5433}}:5432"
    restart: unless-stopped

  bcsmcp:
    build: .
    container_name: bcsmcp
    labels:
      - "ns.module=bcs"
      - "ns.component=mcp"
    env_file: .env
    environment:
      BCS_DB_HOST: bcsdb
      LLM_BACKEND: ${LLM_BACKEND:-llm_mcp}
      LLM_MCP_BASE_URL: ${LLM_MCP_BASE_URL:-http://llmcore:8080}
      LLM_MCP_PROVIDER: ${LLM_MCP_PROVIDER:-auto}
      LLM_BACKEND_FALLBACK_OLLAMA: ${LLM_BACKEND_FALLBACK_OLLAMA:-1}
      LLM_BACKEND_TIMEOUT_SEC: ${LLM_BACKEND_TIMEOUT_SEC:-30}
    restart: unless-stopped
    depends_on:
      - bcsdb
    ports:
      - "127.0.0.1:${PORT_MCP_BCS:-${BCS_MCP_PORT:-3332}}:3333"
